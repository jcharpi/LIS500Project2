<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Our Model</title>
    <link rel="stylesheet" href="stylepage.css" />
  </head>
  <body>
    <header>
      <h1>Our Model</h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="intersectionality.html">Intersectionality</a></li>
          <li><a href="techhero.html">Tech Hero</a></li>
          <li><a href="model.html">Our Model</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <h2>Teachable Machine Image Model</h2>
      <div id="webcam-container"></div>
      <div id="label-container"></div>
      <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
      <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/zkop8Gj-0/"

        let model, webcam, labelContainer, maxPredictions

        // Auto-start when DOM loads
        document.addEventListener("DOMContentLoaded", async () => {
          try {
            const modelURL = URL + "model.json"
            const metadataURL = URL + "metadata.json"

            model = await tmImage.load(modelURL, metadataURL)
            maxPredictions = model.getTotalClasses()

            const flip = true
            webcam = new tmImage.Webcam(400, 400, flip)
            await webcam.setup()
            await webcam.play()

            document
              .getElementById("webcam-container")
              .appendChild(webcam.canvas)
            labelContainer = document.getElementById("label-container")

            for (let i = 0; i < maxPredictions; i++) {
              const predictionDiv = document.createElement("div")
              predictionDiv.className = "prediction-item"
              labelContainer.appendChild(predictionDiv)
            }

            window.requestAnimationFrame(loop)
          } catch (error) {
            console.error("Error initializing model:", error)
          }
        })

        async function loop() {
          webcam.update()
          await predict()
          window.requestAnimationFrame(loop)
        }

        async function predict() {
          const prediction = await model.predict(webcam.canvas)
          for (let i = 0; i < maxPredictions; i++) {
            const confidence = prediction[i].probability.toFixed(2)
            const className = prediction[i].className
            labelContainer.childNodes[i].innerHTML = `
            <span class="bar-span">${className}</span>
            <div class="confidence-container">
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${confidence * 100}%"></div>
                </div>
                <span class="confidence-value">${(confidence * 100).toFixed(1)}%</span>
            </div>
            `
          }
        }
      </script>
    </main>
    <footer>
      <p>&copy; L I S 500 Project #2 - Kaleb, Josh, and Daria</p>
    </footer>
  </body>
</html>
